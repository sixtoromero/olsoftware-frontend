<hr />
<div class="row">
    <div class="col-md-6">
        <p class="lead">Registros de Correspondencia</p>
    </div>
    <div class="col-md-6" style="text-align: right;">
        <button pButton pRipple type="button" icon="pi pi-plus-circle" class="p-button-rounded" (click)="displayModal=true; this.isNew = true; myForm.reset();"></button>
    </div>
</div>    
<p-table 
    #dtCor 
    [value]="results"
    selectionMode="single"    
    dataKey="Id"
    styleClass="p-datatable-correspondences"    
    [rows]="5"
    [paginator]="true" 
    stateStorage="local"
    stateKey="statedemo-local">
    <ng-template pTemplate="header">
        <tr>                                        
            <th pSortableColumn="ProjectId">Id Proyecto <p-sortIcon field="ProjectId"></p-sortIcon></th>
            <th pSortableColumn="ProjectName">Proyecto <p-sortIcon field="ProjectName"></p-sortIcon></th>
            <th pSortableColumn="Customer">Cliente <p-sortIcon field="Customer"></p-sortIcon></th>
            <th pSortableColumn="StartDate">Fecha Inicio <p-sortIcon field="StartDate"></p-sortIcon></th>
            <th pSortableColumn="EndDate">Fecha Fin<p-sortIcon field="EndDate"></p-sortIcon></th>
            <th pSortableColumn="Price">Precio<p-sortIcon field="Price"></p-sortIcon></th>
            <th pSortableColumn="NumberHours">Horas<p-sortIcon field="NumberHours"></p-sortIcon></th>
            <th pSortableColumn="Status">Estado<p-sortIcon field="Status"></p-sortIcon></th>
            <th pSortableColumn="Acciones">Acciones</th>
        </tr>
        <tr>
            <th>
                <input 
                    pInputText 
                    type="text" 
                    (input)="dtCor.filter($event.target.value, 'ProjectId', 'contains')" 
                    [value]="dtCor.filters['ProjectId']?.value" 
                    placeholder="Buscar por Id Proyecto" 
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText 
                    type="text" 
                    (input)="dtCor.filter($event.target.value, 'ProjectName', 'contains')" 
                    [value]="dtCor.filters['ProjectName']?.value" 
                    placeholder="Buscar por Proyecto" 
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText type="text" 
                    (input)="dtCor.filter($event.target.value, 'Customer', 'contains')" 
                    [value]="dtCor.filters['Customer']?.value" 
                    placeholder="Buscar por Cliente" 
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText type="text" 
                    (input)="dtCor.filter($event.target.value, 'StartDate', 'contains')" 
                    [value]="dtCor.filters['StartDate']?.value" 
                    placeholder="Buscar por Fecha Inicio" 
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText type="text" 
                    (input)="dtCor.filter($event.target.value, 'EndDate', 'contains')" 
                    [value]="dtCor.filters['EndDate']?.value" 
                    placeholder="Buscar por Fecha Fin" 
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText type="text" 
                    (input)="dtCor.filter($event.target.value, 'Price', 'contains')" 
                    [value]="dtCor.filters['Price']?.value" 
                    placeholder="Buscar por Fecha Precio"
                    class="p-column-filter">
            </th>
            <th>
                <input 
                    pInputText type="text" 
                    (input)="dtCor.filter($event.target.value, 'Status', 'contains')" 
                    [value]="dtCor.filters['Status']?.value" 
                    placeholder="Buscar por Estado"
                    class="p-column-filter">
            </th>
            <th>                                            
            </th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-result>
        <tr>
            <td>                  
                {{result.ProjectId}}
            </td>
            <td>
                {{result.Type}}
            </td>
            <td>
                {{result.Sender}}
            </td>
            <td>
                {{result.Addressee}}
            </td>
            <td>
                {{result.Subject}}
            </td>
            <td>
                <div class="row" style="text-align:center;">
                    <div class="col-md-2">
                        <button 
                            pButton
                            pRipple
                            type="button"
                            icon="pi pi-trash"
                            (click)="confirmDelete(result.Id)"
                            class="p-button-rounded p-button-info p-button-danger">
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button 
                            pButton
                            pRipple
                            type="button"
                            icon="pi pi-pencil"
                            (click)="editModal(result)"
                            class="p-button-rounded p-button-info p-button-success">
                        </button>
                    </div>
                </div>
            </td>            
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td colspan="4">No correspondences found.</td>
        </tr>
    </ng-template>
</p-table>

<p-dialog 
    header="" 
    [(visible)]="displayModal"
    [modal]="true" 
    [style]="{width: '80vw'}" 
    [baseZIndex]="10000" 
    [draggable]="false" 
    [resizable]="false"
    [closable]="false">
    <div class="row">
        <div class="col-md-12">
            <div class="card card-success">
                <div class="card-header">
                    <h3 class="card-title">Crear Correspondencia</h3>
                </div>
                <div class="card-body">
                    <div class="card card-success">
                        <div class="card-header">                    
                            <div class="row">
                                <div class="col-md-6">
                                    <h3 class="card-title">Registro</h3>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <form [formGroup]="myForm" #Tablefrm="ngForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <h6>Tipo</h6>
                                            <select
                                                class="browser-default custom-select"
                                                formControlName="Type"
                                                [ngClass]="{ 'is-invalid': f.Type.invalid && (f.Type.dirty || f.Type.touched) }">
                                                <option value="CI">Interna</option>
                                                <option value="CE">Externa</option>
                                            </select>
                                            <div *ngIf="f.Type.errors && (f.Type.dirty || f.Type.touched)" class="invalid-feedback">
                                                <div>El tipo es requerido</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Remitente</h6>
                                        <div class="input-group mb-3">                                
                                            <select
                                                class="browser-default custom-select"
                                                formControlName="SenderId"
                                                [ngClass]="{ 'is-invalid': f.SenderId.invalid && (f.SenderId.dirty || f.SenderId.touched) }">
                                                <option *ngFor="let item of Senders" [value]="item.Id">{{item.Id}} {{ item.Names }} {{ item.Surnames }}</option>
                                            </select>                                            
                                            <div *ngIf="f.SenderId.errors && (f.SenderId.dirty || f.SenderId.touched)" class="invalid-feedback">
                                                <div>El tipo es requerido</div>
                                            </div>
                                        </div>                            
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Destinatario</h6>
                                        <div class="input-group mb-3">                                      
                                            <select
                                                class="browser-default custom-select"
                                                formControlName="AddresseeId"
                                                [ngClass]="{ 'is-invalid': f.AddresseeId.invalid && (f.AddresseeId.dirty || f.AddresseeId.touched) }">
                                                <option 
                                                    *ngFor="let item of Addressees"
                                                    [value]="item.Id">
                                                    {{ item.Names }} {{ item.Surnames }}
                                                </option>
                                            </select>
                                            <div *ngIf="f.AddresseeId.errors && (f.AddresseeId.dirty || f.AddresseeId.touched)" class="invalid-feedback">
                                                <div>El tipo es requerido</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <h6>Asunto</h6>
                                            <input 
                                                id="Subject" 
                                                type="text" 
                                                class="form-control" 
                                                formControlName="Subject"
                                                [ngClass]="{ 'is-invalid': f.Subject.invalid && (f.Subject.dirty || f.Subject.touched) }" />
                                            <div *ngIf="f.Subject.errors && (f.Subject.dirty || f.Subject.touched)" class="invalid-feedback">
                                                <div>La ubicación es requerida</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <h6>Mensaje</h6>
                                            <textarea
                                                id="Body" 
                                                type="text" 
                                                class="form-control" 
                                                formControlName="Body"
                                                [ngClass]="{ 'is-invalid': f.Body.invalid && (f.Body.dirty || f.Body.touched) }">
                                            </textarea>
                                            <div *ngIf="f.Body.errors && (f.Body.dirty || f.Body.touched)" class="invalid-feedback">
                                                <div>La ubicación es requerida</div>
                                            </div>
                                        </div>
                                    </div>                                    
                                </div>     
                            </form>                
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <p-footer>            
        <button type="button" pButton (click)="displayModal=false;" label="Cerrar" class="ui-button-secondary"></button>
        <button 
            pButton 
            pRipple 
            type="button" 
            label="Guardar"             
            class="p-button-success"
            [disabled]="!myForm.valid"
            (click)="insertOrupdate()">
        </button>
    </p-footer>
</p-dialog>

<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"></p-confirmDialog>
<ngx-ui-loader></ngx-ui-loader>
<p-toast></p-toast>